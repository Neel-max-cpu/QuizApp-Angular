<div class="p-3 mb-3">
  <button
    class="flex p-3 bg-red-600 text-white font-mono rounded-lg shadow-lg hover:bg-red-700 hover:cursor-pointer"
    (click)="goBackToCategory()"
  >
    <lucide-angular [img]="X" class="my-icon"></lucide-angular>
    Cancel Quiz
  </button>
</div>

<div class="w-full flex items-center justify-center mt-20 p-3">
  <p-card class="w-full overflow-hidden rounded-xl max-w-md">
    <!-- Header -->
    <ng-template pTemplate="header">
      <div class="card p-4">
        <p-progressbar
          class="custom"
          [value]="value"
          [showValue]="false"
        ></p-progressbar>
      </div>
    </ng-template>

    <!-- Title -->
    <ng-template pTemplate="title">
      <ng-container *ngIf="!quizFinished">
        Question No: {{ currentIndex + 1 }}/{{ quizQuestions.length }}
      </ng-container>
      <ng-container *ngIf="quizFinished"> Quiz Finished! </ng-container>
    </ng-template>

    <!-- Subtitle -->
    <ng-template pTemplate="subtitle">
      <ng-container *ngIf="!quizFinished">
        {{ currentQuestion?.category }}
      </ng-container>
      <ng-container *ngIf="quizFinished">
        Your Score: {{ score }} / {{ quizQuestions.length }}
      </ng-container>
    </ng-template>

    <!-- Body -->
    <div *ngIf="!quizFinished">
      <div
        class="text-lg font-semibold mb-4"
        [innerHTML]="currentQuestion?.question"
      ></div>

      <div class="flex flex-col gap-3">
        <button
          *ngFor="let option of shuffledOptions"
          class="p-2 rounded border text-left"
          [ngClass]="{
            'bg-green-300':
              isSubmitted && option === currentQuestion.correct_answer,
            'bg-red-300':
              isSubmitted &&
              option === selectedAnswer &&
              option !== currentQuestion.correct_answer,
            'bg-blue-100': !isSubmitted && option === selectedAnswer,
            'bg-white': !isSubmitted && option !== selectedAnswer
          }"
          [disabled]="isSubmitted"
          (click)="selectAnswer(option)"
          [innerHTML]="option"
        ></button>

        <button
          class="p-2 bg-blue-600 text-white rounded mt-2 disabled:opacity-50"
          [disabled]="!selectedAnswer || isSubmitted"
          (click)="submitAnswer()"
        >
          Submit
        </button>
      </div>

      <div class="text-sm text-gray-500 mt-2">
        Time left: {{ timerLeft }} sec
      </div>
    </div>

    <div
      *ngIf="quizFinished"
      class="flex flex-col items-center justify-center p-6"
    >
      <p class="text-lg mb-2">
        Your Score: {{ score }} / {{ quizQuestions.length }}
      </p>

      <div class="flex gap-4 mt-4">
        <button
          class="p-3 bg-green-600 text-white rounded"
          (click)="mainPage()"
        >
          Go To Main Page
        </button>
        <button
          class="p-3 bg-blue-600 text-white rounded"
          (click)="goBackToCategory()"
        >
          Go to Category Page
        </button>
      </div>
    </div>
  </p-card>
</div>
